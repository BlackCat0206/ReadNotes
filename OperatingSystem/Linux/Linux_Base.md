# Linux_Base

---- Chime Lee

## 一、概述



## 二、内容

### 2.1 Linux系统重进程默认栈空间是多大？如何修改？

Linux系统中，进程默认栈大小由**操作系统内核**设置，通常是8MB。

修改命令：

```bash
# 单位KB
ulimit -s <stack_size>
```

### 2.2 用户空间于内核通信方式有哪些？

* 系统调用：读写文件，创建进程等。
* 文件接口：通过文件接口**读写文件**与内核进行通信。
* proc下文件：读写/proc文件系统的特定文件与内核通信，查询或修改**内核状态和信息**。
* sys_fs：读写/sys文件系统中文件与内核通信，查询或修改**设备属性和参数**。
* netlink套接字：通过netlink套接字与内核通信，用于**网络配置，管理**等。
* 共享内存：映射共享内存区域来读写数据，实现高效数据交换。
* 设备文件：打开读写设备文件与内核进行通信，如**串口设备、字符设备**。

### 2.3 Linux下检查内存状态的命令

* `free`：查询系统内存的使用情况，总内存，已使用内存，可用内存等。
* `top`：系统的整体资源使用情况，显示每个进程使用内存的情况。
* `vmstat`：虚拟内存统计信息，使用情况，交换情况。
* `/proc/meminfo`文件：系统内存的详细信息。
* `pmap`：线程进程内存映射的详细信息，内存地址，权限，映射文件。

### 2.4 自旋锁和互斥锁的使用场景

自旋锁（Spin Lock）和互斥锁（Mutex Lock）常见的线程同步机制。

| 类型     | 自旋锁                                 | 互斥锁               |
| -------- | -------------------------------------- | -------------------- |
| 等待方式 | 忙等待，一直循环检查锁状态，直到获得锁 | 阻塞等待             |
| 切换方式 | 不涉及上下文切换，多核处理器上表现更好 | 需要进行上下文切换   |
| 适用场景 | 时间占用短或竞争不激烈                 | 临界区较长或竞争激烈 |

### 2.5 线程池的设计思路



### 2.6 Linux的fork的作用？

* fork是一个系统调用，用于创建新的进程。
* 创建的子进程会有独立代码路径，可以执行不同的操作。子进程也可以创建新的进程，实现层级关系。
* 返回值不同：每个进程都有独立的进程ID，子进程创建时，父进程会将独立的进程ID赋予子进程。父进程中返回的子进程的ID，子进程的返回值是0。
* 生命周期：父进程和子进程的生命周期是独立的，父进程先消亡，子进程是孤儿进程，由init进程回收。若子进程消亡，但父进程为等待销毁，则为僵尸进程。
* 资源继承：子进程会继承父进程的绝大部分属性，代码、数据、堆栈、进程上下文、打开的文件、环境变量、当前工作目录。

### 2.7 什么是文件系统，它有什么用？

**存储管理：**将文件存储在计算机硬盘、磁盘等固件上，负责**分配和回收存储空间**。

**文件组织：**提供文件结构和目录结构，帮助用户**分层、分组和管理**。

**文件访问控制：**提供文件访问控制权，针对不同的用户设置文件访问权限。可以b。

**文件的操作和管理：**提供了一系列系统接口，实现对文件的打开、读取、写入、删除、压缩等操作，同时访问文件属性（大小、类型、创建时间）等。

**文件共享和备份：**提供了文件共享功能，允许多个用户同时访问和修改同一个文件，提高信息共享。提供文件备份和恢复功能，确保数据安全和可靠性。

### 2.8 进程调度算法是什么？

**先来先服务（FCFS）**：按照进程到达的先后顺序进行调度。先到达的进程先被执行，直到该进程阻塞或完成。

**短作业优先（SJF）**：根据进程执行的时间来调用，执行时间短的进程先被执行。此算法可以**最小化平均等待时间，但可能会导致执行时间长的进程饥饿**。

**最短剩余时间优先（SRTF）**：根据进程剩余执行时间进行调度。刚到达的进程剩余执行时间比当前进程的剩余执行时间短，则进行切换。

**优先级调度**：为每个进程分配一个优先级，优先级高的进程先被执行。

**时间片轮转调度（Round Robin）**:将CPU的时间分配相同的时间片，每个进程在一个时间片内执行，结束后将其加入就绪队列队尾。

**多级反馈队列调用：**将就绪队列分为多个队列，每个队列都有不同的时间片。新到达进程进入第一个队列，执行后若还有时间进入第二个队列，以此类推。根据进程的特性分配不同的优先级。

### 2.9 简述LRU算法及其实现方式

LRU(Least Recently Used)：用于页面置换，当进行进行页面置换时，选择使用最少的页面替换。

### 2.10 什么是页表，作用是什么？

页表（Page Table）：操作系统的数据结构，管理**虚拟内存和物理内存的映射关系**。记录了**进程的页（Page）于物理页框（Page Frame）的对应关系**。

**作用：**

**映射关系：**页表将进程的虚拟内存转换为真实的物理内存，这样进程就可以**使用连续的虚拟地址而不需要关注真实的物理内存布局**。

**内存管理**：将进程的地址空间划分为固定大小的页，将物理内存空间分割为与页大小相同的块。操作系统根据需要进行**页面调度**，将进程所需的虚拟页加载到物理内存中。

**内存保护**：页中记录**访问权限和控制位等信息**。操作系统根据页保存内存空间，进程只能访问其所拥有的内存空间，防止越界访问和违法操作。

**虚拟化技术支持：**虚拟机监控程序会单独维护页面，**将虚拟机内存地址转换为物理内存地址**，隔离不同虚拟机之间的内存空间。

### 2.11 简述缺页中断

**缺页异常：**`malloc()`和`mmap()`只分配了虚拟地址空间，未分配虚拟内存对应的物理内存。当进程访问**没有建立映射关系的虚拟内存**，**处理器自动引发一个缺页异常，触发缺页中断**（*Page Fault*）。

**缺页中断：**产生缺页中断后，操作系统会根据页表中**外存地址**找到外存中缺失的一页，将其调入内存。

**缺页中断执行过程：**

* **CPU触发中断：**程序访问未建立映射关系的虚拟内存->CPU暂停，发出缺页异常，引发缺页中断。（将控制器从CPU转换到操作系统）。
* **内存合法检查：**操作系统内核捕获到中断，检查中断原因，若为非法访问（越界），直接终止进程。若合法但未加载，进入下一步。
* **内存空间准备：**有空闲的物理页框直接用->无空闲则用置换算法（LRU/FIFO）选择一页换出磁盘。
* **加载页面+更新页表：**从磁盘中读取物理页框->更新页表映射关系”，标记该页“已存在”。
* **恢复程序执行：**被中断的程序从缺页异常的指令处，继续执行。

**缺页中断的目的：**实现虚拟内存的概念，允许程序使用比物理内存更大的内存空间，将常用的页放在物理内存中，将不常用的页放在磁盘中，通过缺页中断将磁盘中的页加载到物理内存中。

### 2.12 简述一下虚拟内存和物理内存，为什么要用虚拟内存？

**虚拟内存：**它为每个进程分配了独立的地址空间，这个地址空间就叫做虚拟内存。允许程序使用比物理内存更大的内存。

**物理内存：**计算机中内存硬件，RAM（*Random Access Memory*）组成。

**好处：**

**扩展内存容量：**允许进程访问超过物理内存容量的虚拟地址空间。当物理内存不足时，操作系统将置换出磁盘中不常用的页，释放物理内存空间。

**内存隔离：**每个进程都有独立的虚拟地址空间，一个进程的异常不会影响其他进程。

**简化程序设计：**开发者将内存视为连续存储的地址，不需要关注物理内存的限制和分配。

### 2.13 虚拟地址到物理地址怎么映射？

虚拟地址到物理地址通过页表（Page Table）实现的。页表是操作系统的数据结构，管理虚拟内存和物理内存的映射关系，记录页和物理页框的对应关系。

**程序访问虚拟地址，操作系统将虚拟地址转换为物理地址的过程：**

* 程序生成虚拟地址，地址拆分为： **页号 + 页内偏移**
* 操作系统根据**页号**，在当前进程的**页表**中，找到对应**页表项**。
* 从页表项中取出**物理页框号**，替换**虚拟地址的页号**。
* **物理页框号 + 页内偏移** -> 最终拼接的物理地址。

**32位线性系统地址：页目录索引（10位）、页号（10位）、业内偏移（12位）**

* 从CR3寄存器中取出**页目基地址**。
* 页目录基地址 + 页目录索引->页表地址。
* 页表地址 + 页号 -> 页表项，从页表项中取出**物理页框号**
* 物理页框号 + 页内偏移 -> 物理地址。