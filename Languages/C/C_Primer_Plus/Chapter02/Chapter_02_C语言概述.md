# Chapter 02 C语言概述

***---- Li Jinsheng***

***

## 一、概述

本篇为《C Primer Plus》（第6版）第二章 C语言概述读书笔记与小结

## 二、内容

### 2.1 简单的C程序示例

```C
#include <stdio.h>

int main(void)
{
    int num;
    num = 1;
    
    printf("I am a simple");
    printf("computer.\n");
    printf("My favorite number is %d because it is first");
    
    return 0;
}
```

[^简单的C程序示例]: 程序清单2.1

### 2.2 示例解释

C语言中的6中语句：

| 语句类型   | 定义（核心作用）                  | 示例代码（来自 2.1 简单程序）                              | 嵌入式场景说明                                        |
| ---------- | --------------------------------- | ---------------------------------------------------------- | ----------------------------------------------------- |
| 标号语句   | 标记跳转目标（如 goto 的标签）    | 无（本章未涉及，后续章节补充）                             | 中断服务函数中慎用 goto，避免混乱                     |
| 复合语句   | 用 {} 将多条语句打包为一个块      | `{ int num; num=1; printf(...); }`                         | 函数体、if/for 循环体必须用复合语句                   |
| 表达式语句 | 表达式 +;（执行操作并丢弃结果）   | `num = 1;`（赋值表达式）、`printf(...);`（函数调用表达式） | 嵌入式中最常用的语句类型                              |
| 选择语句   | 分支判断（if/else、switch）       | 无（本章未涉及，后续章节补充）                             | 处理按键、传感器状态判断                              |
| 迭代语句   | 循环执行（for、while、do-while）  | 无（本章未涉及，后续章节补充）                             | 处理定时器中断、数据接收循环                          |
| 跳转语句   | 改变执行流（return、goto、break） | `return 0;`（从 main 返回）                                | main 返回 0 表示程序正常结束，嵌入式中可能返回给 RTOS |

#### 2.2.1 程序细节

1. `#include` 指令和头文件

* `#include <stdio.h>`相当于将`stdio.h`文件中所有内容都输入到该行所在位置。实际上，这是一种拷贝粘贴的作用，提供了一种**共享程序信息**的渠道。

* `#icnlude`是C项的**预处理命令（*proprocessor directive*）**,C编译器在编译前会对源代码做一些准备工作，即***预处理***。

* C程序顶部的信息集合被称为**头文件（*head file*）**。

2. `main()`函数

* C程序一定是从`main(void)`函数开始执行的。
* **圆括号的功能**：用于识别`main(void)`是一个函数。
* **C语言的基本模块**：函数。
* `int`是`main(void)`函数的返回类型。即表示函数返回类型为整数。
* 圆括号内表示函数传入参数的信息，示例中没有，故圆括号内为`void`。
* 注意：`main()`此类写法C90标准勉强可以接受，但是C99和C11标准是不允许的。因此，即使你的编译器允许，也不要这样写。

3. 注释

* 程序中`/* */`两个符号括起来的就是注释。其中内容会被编译器忽略。

```c
/*
 * @brief 测试程序
 * @param [in] void
 * @return int
 */
int main(void)
{
    return 0;
}
```

* C99新增了使用`//`符号作为注释，普遍用于`Java和C++`

4. 花括号、函数体和块

* C函数都是使用花括号（`{}`）作为函数的开始与结束。
* 花括号还可将函数中的多条语句合并为一个**单元或块**。

5. 声明

`int num;`

* 这行代码叫做**声明（*declaration*）**。
* 其完成了两件事情：1.在函数中有一个名为`num`的**变量（*variable*）**。2.这个变量是`int`类型，编译器会根据这些信息对num变量进行**内存分配**。
* `int`是C语言的**关键字（*keyword*）**，是C语言的基本数据类型。
* `num`是一个**标识符（*identifier*）**,用来表示变量、函数或其他实体的名称。
* 声明将**特定的标识符**与计算机的**内存的特定位置**联系起来，同时确定了存储在某个位置的**数据类型**或**信息类型**。
* **所有变量都必须先声明再使用**。
* C99和C11遵循C++惯例，可以把声明放在模块中任一位置。老版本如下：

```c
int main_Old(void) // 旧规矩
{
    int doors;
    int dogs;
    doors = 5;
    dogs = 3;
    // 其他
}

int main_New(void) // 新规矩
{
    int doors;
    doors = 5;
    
    int dogs;
    dogs = 3;
    
    // 其他语句
}
```

* **命名**：可以用**大写字母**、**小写字母**、**数字**和**下划线（\_）**来命名。注意，命名的第1个字符必须是**字母**或**下划线**（\_）。C语言名称**区分大小写**。C99和C11允许使用更长的标识符名，但编译器只能识别**前63个字符**。对于**外部标识符**，只允许识别**前31个字符**。（C90只允许识别前6个字符）。在给变量命名时，要使用**有意义**的变量名或标识符，若变量名无法**清楚的表达自身用途**，可在**注释**中添加说明。

6. 赋值

`num = 1;`

* 这行代码时**赋值表达式语句**，表示将右侧的值赋值给左侧。
* `=`是赋值运算符。

7. `printf()`函数

`printf("I am a simple");`

* **实际参数（*actual argument*）**：传递给函数的特定值，即“I am a simple”。
* **形式参数**：函数中用于存储的变量。
* **转义序列（*secape sequence*）**：都是反斜杠（\\）开始，用于代表单元表达或者无法输入的字符，例：`\t`表示Tab键，`\b`表示Backspace键。
* **占位符**：`%d`用于指示输出num的位置。

8. `return`语句

* `return`是一个**关键字**，其后是待返回的值，返回值类型与函数声明时的类型保持一致。
* 若在`main(void)`函数中忘记写`return`语句，在执行至函数结尾（}）时，会自动返回0。因此`main(void)`函数中可以省略`return`语句，但仅限于`main(void)`,建议保持良好习惯，所有函数均保留`return`语句。

### 2.3 简单的函数结构

* 程序由一个或多个**函数**组成，且必须包含`main(void)`函数。
* 函数由**函数头**和**函数体组成**。

```c
int main(void)
```

* **函数头**：**函数名**、**传入函数的信息类型**、**函数返回类型**组成。通过函数名后的圆括号（`()`）识别出函数。
* **函数体**：由花括号（`{}`）括起来，由一系列的声明、语句组成。

### 2.4 提高程序可读性技巧

* 写注释
* 使用有意义的标识符。
* 函数中使用空行分隔概念上的部分。
* 一行一个语句。

### 2.5 进一步使用C

```c
// fathm_ft.c -- converts 2 fathoms to feet

#include <stdio.h>
int main(void)
{
    int feet, fathoms;	// 多条声明：等价于 int feet; int fathoms;
    
    fathoms = 2;
    feet = 6 * fathoms;	// 乘法
    printf("There are %d feet in %d fathoms!\n", feet, fathoms);	// 多打印多个值
    printf("Yes, I said %d feet!\n", 6 * fathoms);
    
    return 0;
}

```

[^程序清单2.2]: fathm_ft.c程序

### 2.6 多个函数

```c
//* two_func.c -- a program using two functions in one file */
#include <stdio.h>
void butler(void);      /* ANSI/ISO C function prototyping */
int main(void)
{
    printf("I will summon the butler function.\n");
    butler();
    printf("Yes. Bring me some tea and writeable DVDs.\n");
    
    return 0;
}

void butler(void)       /* start of function definition */
{
    printf("You rang, sir?\n");
}

```

[^程序清单2.2]: two_func.c程序

* `butler()`函数：该函数在上述示例中共出现了三次；
  * 第一次为**函数原型（*prototype*）**也叫做**函数声明（*function decaleration*）**，用于告知编译器在程序中将要使用该函数，同时说明了函数的属性信息：返回类型为空，输入参数类型为空。（C90新增标准，旧的编译器可能无法识别）
  * 第二次为**函数调用（*function call*）**。
  * 第三次为**函数定义（*function defintion*）**，即函数本身。
* `void`的意思时空的，而不是无效。

`void butler()`

* 早期函数声明类似上面，C90 C99 C11标准都承认旧版本的形式，如果使用老式的编译器，就要去掉示例代码中圆括号的`void`。

| 类型     | 格式示例                             | 核心作用                               | 嵌入式场景注意事项                                           |
| -------- | ------------------------------------ | -------------------------------------- | ------------------------------------------------------------ |
| 函数原型 | `void butler(void);`                 | 告知编译器：函数名、返回类型、参数类型 | 原型必须在调用前声明（如放在头文件中，避免跨文件调用报错）   |
| 函数定义 | `void butler(void) { printf(...); }` | 实现函数的具体逻辑                     | 定义只能有一次（避免重复定义错误，嵌入式中常放在.c 文件）    |
| 函数调用 | `butler();`                          | 触发函数执行，传递实参（若有）         | 中断服务函数中调用的函数需避免 “不可重入”（如用 static 变量） |

### 2.7 调试程序

```c
/*  nogood.c -- a program with errors */
#include <stdio.h>
int main(void)
(
 int n, int n2, int n3;
 
/* this program has several errors
 n = 5;
 n2 = n * n;
 n3 = n2 * n2;
 printf("n = %d, n squared = %d, n cubed = %d\n", n, n2, n3)
 
 return 0;
 )

```

[^示例程序2.4]: nogood.c 程序

#### 2.7.1 语法错误

**C语言的语法错误**：把有效C符号房子了无效的位置。

* 函数后要跟花括号（`{}`）。
* 形参声明时：`int n, n2, n3;`。
* `/**/`注释没有对应的结束符：`*/`。

如何发现语法错误：自检与编译器，有时不需要修改编译器的所有报错，只需要修改关键地方即可。

#### 2.7.2 语义错误

C语言的语义错误：C语言中遵循了C规则，但结果不对，就犯了语义错误。

* n3的原意为n的立方，但最终结果却是n的4次方，

#### 2.7.3 修复程序

```c
/*  nogood.c -- a program with errors */
#include <stdio.h>
int main(void)
{
 int n, n2, n3;
 
/* this program has several errors*/
 n = 5;
 n2 = n * n;
 n3 = n2 * n;
 printf("n = %d, n squared = %d, n cubed = %d\n", n, n2, n3)
 
 return 0;
}
```

#### 2.7.4 程序状态

**程序状态（*program state*）**：执行程序的过程中，某个给定点上所有变量值的集合。

跟踪程序状态的方案：

* 手动模拟。
* 添加打印。
* debugger调试器。

### 2.8 关键字和保留标识符

* **关键字不能作为标识符**，其主要用于说明指定类型，或用于控制语句中的执行顺序。
* **关键字是C语言的概念**。

## 三、小结

本章主要简单介绍了C语言的基本概念：

`#include`：预处理命令，用户将其后文件内容全部输入至所在行。

C语言基本模块：函数。

声明：为变量（**在C语言用来表示存储在内存中的特定数据单元**）指定变量名，并说明其数据类型，编译器根据对应类型在计算机内存中为其分配空间。变量名就是标识符，它不能和C语言中关键字重复，否则会引发编译器报错。所有变量必须先声明在使用。

函数：函数由函数头和函数体构成。函数头说明函数名称、函数的返回数据类型、传入函数数据的类型用圆括号进行识别。函数体由花括号包括，其由声明、语句的集合构成。函数的调用为**函数调用语句**、**函数表达式**。

赋值：赋值语句是将值赋值给变量，或者说是将值存储在对应内存中。

实参：调用函数时传入的特定内容。

形参：函数中存储数据的内容。

转义符：\\反斜杠开头，用于表示部分难以表达或输入的字符。

占位符：%开头，在`printf()`中用于表示该位置变量输出的位置。第三章称为转换说明

语法错误：将C语言中正确的符号放在错误的位置。

语义错误：遵循C语言规则，但程序结果不对。

