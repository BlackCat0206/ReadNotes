# C语言中外部变量与静态变量初始化限制

在 C 语言中，**初始化外部变量（全局变量）时，确实必须使用常量表达式**，而不能用另一个外部变量来初始化。这是 C 语言的明确规定，与变量是否被 `static` 修饰无关，仅因为它们属于 “外部存储类别”（具有静态存储期）。

### 具体规则说明

1. **外部变量的初始化要求**

   外部变量（定义在函数外部的变量）属于静态存储类别，其初始化表达式必须是**编译期可计算的常量表达式**。例如：

   ```c
   int a = 10;          // 合法：10 是常量表达式
   int b = a + 5;       // 非法：a 是外部变量，不是常量表达式
   extern int c = 20;   // 合法：20 是常量表达式
   ```

   上面的 `b = a + 5` 会编译报错，因为 `a` 是外部变量，其值在编译期无法被编译器视为 “常量”（即使 `a` 被 `const` 修饰，C 语言中 `const` 变量仍被视为 “只读变量”，而非编译期常量）。

2. **为什么不能用外部变量初始化？**

   外部变量的初始化在**程序加载阶段**（编译链接后，运行前）完成，此时程序尚未开始执行，变量的值无法被动态计算。编译器需要在编译期就确定初始化值，而外部变量的值在编译期无法被 “预知”（即使它在代码中定义在前面），因此不允许作为初始化表达式。

3. **与局部静态变量的一致性**

   这一规则同样适用于局部静态变量（`static` 修饰的局部变量），它们也必须用常量表达式初始化：

   ```c
   void func() {
       static int x = 5;       // 合法：5 是常量表达式
       static int y = x + 3;   // 非法：x 是静态变量，不是常量表达式
   }
   ```

### 示例代码（错误与正确对比）

```c
// 错误示例：用外部变量初始化另一个外部变量
int a = 100;
int b = a;  // 编译报错：初始化元素不是常量表达式

// 正确示例：用常量表达式初始化外部变量
int c = 100;
int d = 200;  // 合法
int e = c + 100;  // 非法（c 是外部变量）
int f = 100 + 200;  // 合法（100+200 是常量表达式）
```

### 总结

C 语言规定：**外部变量（全局变量）和静态变量的初始化必须使用常量表达式**，不能用另一个外部变量（即使是同类型）作为初始化值。这是因为这类变量的初始化在程序加载阶段完成，依赖编译期可确定的常量，而外部变量的值在编译期无法被视为 “常量”。这一规则在《C Primer Plus》中讲解 “存储类别”（通常在第 12 章）时会涉及，是 C 语言中静态存储期变量的重要特性。