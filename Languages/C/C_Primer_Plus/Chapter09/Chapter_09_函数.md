# Chapter_09_函数

***---- Li Jinsheng***

***

## 一、概述

本章为《C Primer Plus》（第6版）第9章读书笔记

## 二、内容

### 2.1 函数

#### 2.1.1 概念

函数（*function*）：可以完成特定功能的代码模块。使用函数可以实现功能复用，减少工作量，与第一章中所提到的C语言的模块化设计。

```c
返回值类型 函数名 （形参类型 形参名）
{
    语句；
}
```

#### 2.1.2 签名（*signature*）

C语言术语 签名（*signature*）：函数的返回值类型与传入参数类型这些信息被称为签名。

#### 2.1.3 函数的形参

* ANSI C要求的形参必须声明其类型：

```c
// 标准
void test(int num1, int num2);
```

* ANSI C也接受不说明变量名

```c
void test(int, int);
```

* ANSI C接受老版本的函数声明（对形参没有说明）

```c
void test();
```

* ANSI C也接受ANSI C之前的形式，了解即可，方便日后阅读老版本代码

```c
void test(num1, num2)
int num1, int num2;
```

#### 2.1.4 形参与实参

形参：函数原型中声明函数所需变量的参数类型。

实参：调用函数更具函数原型传入的对应变量。

传参的过程大部份是将数据拷贝了一份而不是直接使用。

#### 2.1.5 函数说明

```c
/**
 * @brief 
 * @param
 * @return
 * @attention
 */
```

日常工作中，因开发者习惯不同，部分功能函数阅读难度较大，故建议对函数添加说明，增强代码可读性与维护性。

#### 2.1.6 return 语句

一个函数中可以使用多条`return`语句，但注意，在`return`前要确保数据安全（例：函数中申请的堆内存已经释放，若没有可能会导致内存泄漏）。

#### 2.1.7 函数类型

C99之前若声明函数原型时没有指明返回值类型，默认是`int`类型。C99之后此类操作认为是违规的。

### 2.2 ANSI C函数原型

#### 2.2.1 ANSI C标准之前的问题

```c
int imax();

int main()
{
    printf("Max: %d", imax(3));
    printf("Max：%d", imax(3.00, 2.55));
    return 0;
}

int imax(int ,int)
int num1, int num2;
{
    return num1 > num 2 ? num1 : num2;
}
```

* 函数原型中为说明参数类型与数量，导致调用函数时参数数量与类型传输错误，编译器无法感知。

#### 2.2.2 ANSI C解决方案

* 执行函数原型，即声明函数原型时需要说明，函数返回值类型，函数参数类型与个数。

#### 2.2.3 无参数和待定参数

* ANSI C中若函数无参数可以填写`void`明确说明：

```c
void test(void);
```

* 部分函数会根据传入参数的不同，而进行动态的处理，例`printf()`

```c
printf(const char*, ...);
```

* `...`表示可能还有其他未指定类型。

### 2.3 递归（在后续的算法中进一步学习）

* C函数允许自己调用自己，这调用过程称为递归（*recursion*）。二叉树的算法比较常见。
* 尾递归（tail  recursion），使用函数的返回值作为递归数据。

### 2.4 取地址符：&

指针（pointer）用于存放变量的地址。（下一章会有仔细说明）

使用`&`可以获取变量所在的地址。

```c
int num1 = 0;
printf("num1 addrs is :%p\n", &num1);
```

* 注：不要对表达式使用取地址运算符。
* 其运算对象是左值，返回结果是右值。

### 2.5 指针简介

指针（*pointer*）：一个存放内存地址的变量。

#### 2.5.1 间接运算符：`*`

间接运算符（*indirection operator*）`*`，有时也被称为解引用运算符（*dereferencing operator*）C++中常用。用来读取指针中所存储的地址说所指向的数据。

```c
ptr = &bat;
val = *ptr; // 找出ptr指向的内容

// 等同于：这也是间接运算符名称的由来。
val = bat;
```

#### 2.5.2 指针的声明

* 指针声明是其类型必须与**所指向类型**保持一直。

```c
int *pInt;
char *pChar;
float *pFloat;
```

* 个人理解，指针本身存储的都是内存地址，但在使用是需要进行解引用，各项数据类型所占内存均不相同，编译器应该要更具指针的类型读取对应大小的数据。

### 2.6 变量、名称、地址和值

* 在第二章笔记（2.2.1节）中提到“声明将**标识符**与**计算机中内存的地址**联系在一起，并说明了其中所存储的**数据类型**或**信息类型**。”
* 程序对开发者而言，更多是注重变量与其对应的值。
* 程序对计算机而言，更多是注重地址和其对应的值。

## 三、小结

函数作为C语言的基本模块，实现了C语言中模块化设计特定、功能复用等特点。在工作和学习中切记注意函数规范，返回值、函数参数个数与各参数类型的声明和使用，最好加函数头注释进行说明。同时，对于ANSI C所兼容的函数声明需要了解。本章同时简单介绍了指针的声明与使用方式，在第一章中提到C语言的**微调控能力**将会在此体现，关于指针的具体内容将会在下一章与后续《C and Pointer 》中具体阐述。