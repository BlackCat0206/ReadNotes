# USB

---- Chime Lee

## 一、概述

**USB拓扑结构**：**主机（Host）- 集线器（Hub）-设备（Device）三级结构**，主机是唯一的控制方。

**USB设备层次**：

* **设备（Device）**：整个USB设备，对应驱动中`struct usb_deivce`;
* **配置（Configuration）**：设备的**工作模式**（如高速/低速），一个**设备可有多配置**，**同一时间仅激活一个**，对应`struct usb_host_config`;
* **接口（Inertface）**：设备的**功能单元**（鼠标的输入输出接口），一个**配置可有多个接口**，对应`struct usb_interface`;
* **端点（Endpoint）**：数据传出的**最小单元**，每个**接口有多个端点**，分为：
  * **控制端点（Endpoint 0）** ：双向，用于**设备枚举**，**命令交互**，所有设备必带；
  * **批量端点（Bulk）**：用于**大量数据传输（U盘）**，可靠但无实时性；
  * **中断端点（Interrupt）**：用于**小批量**，**实时性数据**（鼠标、键盘）；
  * **等待端点（Isochronous）**：用于**实时数据（摄像头、音频）**，**不保证可靠但保证时序**；

* **USB枚举过程**：主机通过`Endpoint 0`给设备下发命令，获取**设备描述符、配置描述符、接口描述符、端点描述符**，最终**分配地址并加载驱动**。

