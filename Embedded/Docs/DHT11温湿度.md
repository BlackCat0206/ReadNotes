# DHT11温湿度

---- Chime Lee

## 一、概述

使用GPIO管脚与DHT11进行数据通信试验。

**DHT11：**

使用单根总线与主机进行双向串行数据传输。

温度精度在2摄氏度波动，检测范围：-20 ~ 60摄氏度。

**DHT11通信协议：**

* 主机未与DHT11通信时，总线处于空闲状态，此时总线电平由于上拉电阻处于**高电平**。
* 主机与DHT11通信时，总线处于通信状态，一次完成的通信流程如下：
  * 主机将对应GPIO管脚配置为输出，准备相DHT11发送数据。
  * 主机向发送一个开始信号：
    * 一个低脉冲 + 一个高脉冲。
    * 低脉冲至少持续**18ms**，高脉冲持续**20~40us**。
  * 主机将GPIO管脚配置为输入，准备接收DHT11传来的数据，这里信号由上拉电阻拉高；
  * DHT11发出响应信号：
    * 一个低脉冲 + 一个高脉冲。
    * 低脉冲持续**80us**，高脉冲持续**80us**。
  * DHT11发出数据信号：
    * 数据0的一位信号 = 一个低脉冲 + 一个高脉冲。低脉冲持续**50us**，高脉冲持续**26~28us**。
    * 数据1的一位信号 = 一个低脉冲 + 一个高脉冲。低脉冲持续**50us**，高脉冲持续**70us**。
  * DHT11发出结束型号
    * 最后1bit数据传输完毕后，DHT11拉低总线50us，然后是否总线，总线由上拉电阻拉高进入空闲状态。

**数据格式：**

**8bit 湿度整数数据 + 8bit湿度小数数据 + 8bit温度整数数据 + 8bit温度小数数据 + 8bit校验和**

校验和等于“8bit 湿度整数数据+8bit 湿度小数数据+8bi温度整数数据+8bit 温度小数数据”所得结果的末 8 位 。

**如何得到一位数据？**

等待低电平结束，**一直等到高电平出现**；然后延后**40us**，读取GPIO的值：这就是该位的数据值。

## 二、设计思路

DHT11_Init：

* GPIO设置为输出模式，对外输出高电平，延时2s。

DHT11_start：

* GPIO对外输出低电平，延时20ms。
* GPIO对外输出高电平，延时40us。

等待DHT11的响应：

* 低电平：80us
* 高电平：80us

DHT11_Receive：

* 轮询逐位接收。
* 延时等待高电平，延时1000us
* 左移数据
* 读取当前电平，若为高电平则 `data |= 1`
* 延时低电平，延时1000us

通过DHT11_Receive：接收湿度整数、湿度小数位、温度整数、温度小数位、校验和

校验和 == 接收湿度整数 + 湿度小数位 + 温度整数 + 温度小数位